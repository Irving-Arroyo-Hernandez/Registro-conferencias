<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Registro</title>
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
<script>
(function(){
   emailjs.init("rB4Q0pRq4BoiBNgfs"); // Pon tu user ID
})();
</script>
</head>
<body>

<h2>Registro a Conferencias</h2>

<input id="nombre" placeholder="Nombre"><br><br>
<input id="correo" type="email" placeholder="Correo"><br><br>

<select id="conferencia">
  <option value="">Selecciona una conferencia</option>
  <option value="Inteligencia Artificial">Inteligencia Artificial</option>
  <option value="Ciberseguridad">Ciberseguridad</option>
  <option value="Desarrollo Web">Desarrollo Web</option>
</select><br><br>

<button onclick="registrar()">Registrarse</button>

<script>
function registrar() {
  const nombre = document.getElementById("nombre").value;
  const correo = document.getElementById("correo").value;
  const conferencia = document.getElementById("conferencia").value;
  const token = Math.floor(1000 + Math.random() * 9000);

  // Guardar datos en Google Sheets
  fetch("https://script.google.com/macros/s/AKfycbyq-RogThV-QIAId0FEGKGm2WGTIYuMneTM0eL4JZOBIG2WldaKAkuF_vRgOHN6gRI2jw/exec", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    nombre: nombre,
    correo: correo,
    token: token,
    conferencia: conferencia
  })
  // ❌ NO uses 'mode: no-cors'
})
.then(response => response.json()) // Lee la respuesta JSON
.then(data => {
  if (data.result === "success") {
    alert("Registro guardado y correo enviado!");
  }
})
.catch(error => {
  console.error(error);
  alert("Error al registrar");
});


  return ContentService
    .createTextOutput(JSON.stringify({ result: "fail" }))
    .setMimeType(ContentService.MimeType.JSON);
}


  // Enviar token por correo
  emailjs.send("service_g66lq8a", "template_kzds39q", {
      to_name: nombre,
      to_email: correo,
      token: token
  })
  .then(() => alert("Te enviamos un código a tu correo."))
  .catch(() => alert("Error al enviar el correo."));

</script>

</body>
</html>
